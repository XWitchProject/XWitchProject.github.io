<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NXML: NXML</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NXML
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceNXML.html">NXML</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="namespaceNXML.html">NXML</a> is a handwritten two-way parser and scripted transformation engine for XML*, written in C#. It allows you to read and write XML* files. The XML.Script subproject provides a runtime and an API for Lua scripts to transform any XML* files in a fairly straightforward manner.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
*Not Actually XML</h1>
<p><a class="el" href="namespaceNXML.html">NXML</a> was created specifically for Noita. Noita makes use of a custom parser that pretends to be an XML parser but actually violates about half of the standard, causing endless headaches for people who want to create external tools. Its mere existence is a violation of the XML specification, as it's a highly lenient parser - it feels more like a weird mix of HTML and XHTML. Even the files the actual game uses reflect this pretty well - full of typos, mistakes and other trash.</p>
<p>As an example, the <a href="https://github.com/NoitaOmmel/Ommel">Ommel</a> project currently uses a <a href="https://github.com/NoitaOmmel/HTMLAgilityPack">modified version of an HTML parsing library</a> to even be able to <em>read</em> these files - as expected, most XML parsing libraries follow the spec quite closely and are very strict, as they very well should. <a class="el" href="namespaceNXML.html">NXML</a> provides you a library to work with these "noita flavored XHTML/HTML" files. With <a class="el" href="namespaceNXML.html">NXML</a> you can ensure that not only will the data you read be correct, the data you write will also be as the game expects it to be. An example here is that Noita's parser lacks any special handling for character entities like <code>&lt;</code> - however, it will happily accept literal characters that are otherwise illegal like <code>&lt;</code> in attribute values. This is completely opposite to what the spec says and what every single XML library out there implements, but here we are.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Parsing</h1>
<p><a class="el" href="namespaceNXML.html">NXML</a> is based on code from <a href="https://github.com/gummikana/poro/blob/SDL2/source/utils/xml/cxmlparser.cpp">poro</a> - this is the library that Noita actually uses for, among other things, parsing XML files and it just so happens to be written by most of the people who actually work on Noita. It's licensed under the FSF&amp;OSI-approved zlib license, therefore there should be no licensing issues. <a class="el" href="namespaceNXML.html">NXML</a> parses XML files exactly the same as Noita.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
NXML.Script</h1>
<p><a class="el" href="namespaceNXML_1_1Script.html">NXML.Script</a> runs on top of the standard Lua 5.1 implementation (or LuaJIT) to expose an API for XML element manipulation/transformation. <a class="el" href="namespaceNXML_1_1Script.html">NXML.Script</a> enables you to use a Lua script to modify an XML file procedurally, which gives you a lot of freedom to implement automated tasks easily.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Example</h2>
<div class="fragment"><div class="line">function Transform(elem)</div>
<div class="line">        elem.Children:iter(function(i, el)</div>
<div class="line">                Transform(el)</div>
<div class="line">        end)</div>
<div class="line"> </div>
<div class="line">        if elem.Name == &quot;Entity&quot; then</div>
<div class="line">                local new_luacomp = xmlnew(&quot;LuaComponent&quot;)</div>
<div class="line">                local a = new_luacomp.Attributes</div>
<div class="line">                a.script_source_file = &quot;mods/blah/etc/test.lua&quot;</div>
<div class="line">                a.vm_type = &quot;ONE_PER_COMPONENT_INSTANCE&quot;</div>
<div class="line">                a.execute_on_added = &quot;1&quot;</div>
<div class="line">                a.execute_every_n_frame = &quot;-1&quot;</div>
<div class="line">                a.execute_times = &quot;1&quot;</div>
<div class="line">                a.enable_coroutines = &quot;1&quot;</div>
<div class="line"> </div>
<div class="line">                elem.Children:insert(1, new_luacomp)</div>
<div class="line">        end</div>
<div class="line">end</div>
</div><!-- fragment --><p>Before: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">Entity</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ElectricityComponent</span> <span class="keyword">energy</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">probability_to_heat</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">speed</span>=<span class="stringliteral">&quot;0&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">LuaComponent</span> <span class="keyword">blah</span>=<span class="stringliteral">&quot;blah&quot;</span> /&gt;</div>
<div class="line">&lt;/<span class="keywordtype">Entity</span>&gt;</div>
</div><!-- fragment --><p>After: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">Entity</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">LuaComponent</span> <span class="keyword">script_source_file</span>=<span class="stringliteral">&quot;mods/blah/etc/test.lua&quot;</span> <span class="keyword">vm_type</span>=<span class="stringliteral">&quot;ONE_PER_COMPONENT_INSTANCE&quot;</span> <span class="keyword">execute_on_added</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">execute_every_n_frame</span>=<span class="stringliteral">&quot;-1&quot;</span> <span class="keyword">execute_times</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">enable_coroutines</span>=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">ElectricityComponent</span> <span class="keyword">energy</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">probability_to_heat</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">speed</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">LuaComponent</span> <span class="keyword">blah</span>=<span class="stringliteral">&quot;blah&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">Entity</span>&gt;</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
